SKILL: OpenClaw Architecture, Security, and Configuration

This document serves as a comprehensive technical guide for OpenClaw, detailing gateway operations, security hardening, sandboxing, and advanced configuration schemas. It was generated by crawling the official documentation at docs.openclaw.ai.

## 1. Gateway Security & Auditing

Security in OpenClaw is based on the principle of **"access control before intelligence."**

### Security Audit Checklist
Run `openclaw security audit` regularly to detect common misconfigurations.

| Check | Description | Risk |
| :--- | :--- | :--- |
| **Gateway Auth** | Ensures `gateway.auth.token` is set when exposed to network. | Unauthorized control of the agent. |
| **Elevated Mode** | Checks for `system.elevated: true` or `elevated: true` in tools. | Full host shell access. |
| **Browser Control** | Checks if the browser tool is exposed without sandboxing. | Local network/P2P pivot point. |
| **Filesystem** | Validates `fs.root` and `fs.allowList` permissions. | Data exfiltration or host overwrite. |
| **Sandbox Audit** | Ensures `sandbox.mode` is correctly configured (docker/firecracker). | Escape to host environment. |

### Hardened Baseline (60 Seconds)
```json
{
  "gateway": {
    "auth": { "token": "YOUR_SECURE_TOKEN" },
    "bind": "127.0.0.1"
  },
  "agents": {
    "defaults": {
      "sandbox": { "mode": "docker" }
    }
  }
}
```

## 2. Sandboxing & Tool Policies

OpenClaw supports multiple layers of isolation for tools and code execution.

### Isolation Modes
*   **None (`off`)**: Tools run directly on the host. Highly dangerous for untrusted agents.
*   **Docker**: Standard process isolation. Recommended for most production use cases.

### Comparison Table

| Feature | Sandbox (Docker) | Tool Policy | Elevated Mode |
| :--- | :--- | :--- | :--- |
| **Execution** | Code runs in container. | Blocks specific tool IDs. | Runs as host root/user. |
| **Filesystem** | Only mounted volumes. | No effect on FS. | Full host access. |
| **Network** | Isolated bridge. | N/A | Host network. |
| **Best For** | Browser, Python, Node. | Restricting "dangerous" tools. | Local dev/Automation. |

### Sandbox "Jail" Fixes
If a tool (`Tool X`) is blocked, apply one of these fixes in `openclaw.json`:
*   **Allow tool**: Add to `tools.sandbox.tools.allow`.
*   **Disable per-agent**: Set `agents.list[].sandbox.mode = "off"`.
*   **Remove from deny**: Check `tools.sandbox.tools.deny` (default includes `system.run`).

## 3. Configuration Reference (JSON Schema)

The `openclaw.json` (or `.env` for simple cases) is the core configuration file.

### Core Schema Snippets

#### Gateway Configuration
```json
"gateway": {
  "port": 18789,
  "bind": "127.0.0.1",
  "auth": {
    "token": "secret-token",
    "trustedProxies": ["10.0.0.0/8"]
  },
  "logging": {
    "level": "info",
    "stdout": true,
    "file": "~/.openclaw/logs/gateway.log"
  }
}
```

#### Multi-Model Providers
```json
"models": {
  "providers": [
    {
      "id": "openai",
      "apiKey": "sk-...",
      "models": ["gpt-4o", "gpt-4-turbo"]
    },
    {
      "id": "anthropic",
      "apiKey": "x-...",
      "models": ["claude-3-5-sonnet-latest"]
    }
  ]
}
```

#### Channel (Discord/Telegram) Setup
```json
"channels": {
  "discord": {
    "enabled": true,
    "token": "DISCORD_BOT_TOKEN",
    "applicationId": "...",
    "intents": ["MessageContent", "GuildMessages"]
  }
}
```

## 4. Advanced Operations

### Background Processes
Tools can be configured to run in the background using the `background` property in tool definitions.
```json
{
  "id": "long_running_task",
  "background": true,
  "timeout": 3600000
}
```

### Webhook Mappings
Configure incoming webhooks to trigger agent actions.
```json
"hooks": {
  "enabled": true,
  "mappings": [
    {
      "id": "github-pr",
      "match": { "path": "github/pr" },
      "action": "agent",
      "messageTemplate": "New PR: {{body.pull_request.title}}"
    }
  ]
}
```

### Common Pattern: Local Models Only (Offline Mode)
```json
{
  "models": {
    "providers": [
      {
        "id": "ollama",
        "baseUrl": "http://localhost:11434/v1",
        "models": ["llama3", "mistral"]
      }
    ]
  },
  "agents": {
    "defaults": {
      "offline": true
    }
  }
}
```

## 5. Troubleshooting & Maintenance

*   **Audit logs**: Check `~/.openclaw/logs/` for security events.
*   **Doctor command**: Run `openclaw doctor` to verify environment health (Puppeteer, Docker, API keys).
*   **Health Checks**: Use `GET /health` to monitor gateway connectivity and provider latency.

This guide provides the technical foundation for building, securing, and scaling OpenClaw agents. Regular audits and strict sandboxing of external tools are mandatory for production deployments.
